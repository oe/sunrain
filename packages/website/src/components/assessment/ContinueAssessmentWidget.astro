---
// 继续评测组件 - Astro 版本，用于减少闪烁
import { initializeQuestionBank } from '@/lib/assessment/initializeQuestionBank';
import { getLocale } from 'astro-i18n-aut';
import { createSSGTranslations } from '@/i18n/utils';
import type { Language } from '@sunrain/shared';

const currentLang = getLocale(Astro.url) as Language;
const t = createSSGTranslations(currentLang, 'assessment');

// 初始化问卷库数据
await initializeQuestionBank();
---

<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-8">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
      {t('continue.title')}
    </h2>
    <div class="text-sm text-gray-500 dark:text-gray-400">
      {t('continue.subtitle')}
    </div>
  </div>

  <!-- 占位符内容，避免闪烁 -->
  <div id="continue-assessment-placeholder" class="space-y-4">
    <div class="flex items-center justify-center py-8">
      <div class="animate-pulse flex items-center space-x-2">
        <div class="w-4 h-4 bg-blue-500 rounded-full animate-bounce"></div>
        <span class="text-gray-600 dark:text-gray-300">{t('continue.loading')}</span>
      </div>
    </div>
  </div>

  <!-- 实际的客户端组件 -->
  <div id="continue-assessment-content" class="hidden">
    <div id="continue-assessment-react-root"></div>
  </div>
</div>

<script>
  // 动态加载 React 组件
  document.addEventListener('DOMContentLoaded', async () => {
    const placeholder = document.getElementById('continue-assessment-placeholder');
    const content = document.getElementById('continue-assessment-content');
    const root = document.getElementById('continue-assessment-react-root');
    
    if (placeholder && content && root) {
      try {
        // 动态导入 React 组件
        const { default: ContinueAssessmentPage } = await import('@/components/assessment/ContinueAssessmentPage');
        
        // 创建 React 根元素并渲染组件
        const { createRoot } = await import('react-dom/client');
        const reactRoot = createRoot(root);
        reactRoot.render(ContinueAssessmentPage({ asWidget: true }));
        
        // 显示内容，隐藏占位符
        placeholder.style.display = 'none';
        content.classList.remove('hidden');
      } catch (error) {
        console.error('Failed to load ContinueAssessmentPage:', error);
        // 如果加载失败，显示错误信息
        placeholder.innerHTML = '<div class="text-red-500">Failed to load continue assessment widget</div>';
      }
    }
  });
</script>
