---
import { getLocale } from 'astro-i18n-aut';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { type Language } from '@sunrain/shared';
import { useGuideTranslations, getRelativeLocaleUrl } from '@/i18n/utils';

const lang = getLocale(Astro.url) as Language;

const t = useGuideTranslations(lang);

import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const guides = await getCollection('guide', ({ id }) => id.startsWith('en/'));
  return guides.map((guide) => ({
    params: {
      slug: guide.slug.replace('en/', '')
    },
    props: { guide }
  }));
}

interface Props {
  guide: CollectionEntry<'guide'>;
}

const { guide } = Astro.props;
const { Content } = await guide.render();
---

<BaseLayout
  title={guide.data.title}
  description={guide.data.description}
  lang={lang}
>
  <div class="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 dark:from-gray-900 dark:to-gray-800">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Breadcrumb -->
      <nav class="mb-8">
        <ol class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <li>
            <a
              href={getRelativeLocaleUrl(lang)}
              class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">{t('nav.home')}</a
            >
          </li>
          <li>
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"></path>
            </svg>
          </li>
          <li>
            <a
              href={getRelativeLocaleUrl(lang, '/guide/')}
              class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">{t('nav.guide')}</a
            >
          </li>
          <li>
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"></path>
            </svg>
          </li>
          <li class="text-gray-900 dark:text-white font-medium">{guide.data.title}</li>
        </ol>
      </nav>

      <!-- Article Header -->
      <header class="mb-8 pb-8 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg p-8 shadow-sm">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
          {guide.data.title}
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 mb-6">
          {guide.data.description}
        </p>

        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
          <div class="flex items-center">
            <svg
              class="w-4 h-4 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              ></path>
            </svg>
            {t('detail.publishedOn')}: {
              guide.data.publishDate.toLocaleDateString(lang === 'zh' ? 'zh-CN' : 'en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })
            }
          </div>

          {
            guide.data.updateDate && (
              <div class="flex items-center">
                <svg
                  class="w-4 h-4 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                  />
                </svg>
                {t('detail.updatedOn')}:{' '}
                {guide.data.updateDate.toLocaleDateString(lang === 'zh' ? 'zh-CN' : 'en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </div>
            )
          }

          {
            guide.data.author && (
              <div class="flex items-center">
                <svg
                  class="w-4 h-4 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                  />
                </svg>
                {t('detail.author')}: {guide.data.author}
              </div>
            )
          }
        </div>

        {
          guide.data.tags && guide.data.tags.length > 0 && (
            <div class="mt-4">
              <div class="flex flex-wrap gap-2">
                {guide.data.tags.map((tag) => (
                  <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-sm rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          )
        }
      </header>

      <!-- Article Content -->
      <article class="prose prose-lg prose-blue dark:prose-invert max-w-none bg-white dark:bg-gray-800 rounded-lg p-8 shadow-sm">
        <Content />
      </article>

      <!-- Navigation -->
      <nav class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
        <div class="flex justify-between items-center">
          <a
            href={getRelativeLocaleUrl(lang, '/guide/')}
            class="inline-flex items-center px-4 py-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"
          >
            <svg
              class="w-4 h-4 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"></path>
            </svg>
            {t('actions.backTo')} {t('page.title')}
          </a>

          <div class="flex space-x-4">
            <button
              onclick="window.print()"
              class="inline-flex items-center px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"
            >
              <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
                ></path>
              </svg>
              {t('actions.print')}
            </button>

            <button
              onclick="navigator.share ? navigator.share({title: document.title, url: window.location.href}) : navigator.clipboard.writeText(window.location.href).then(() => alert('Link copied!'))"
              class="inline-flex items-center px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"
            >
              <svg
                class="w-4 h-4 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
                ></path>
              </svg>
              {t('actions.share')}
            </button>
          </div>
        </div>
      </nav>
    </div>
  </div>
</BaseLayout>

<style>
  @import '@/styles/tailwind.css';

  /* Light theme prose styles */
  .prose {
    --tw-prose-body: theme('colors.gray.700');
    --tw-prose-headings: theme('colors.gray.900');
    --tw-prose-lead: theme('colors.gray.600');
    --tw-prose-links: theme('colors.blue.600');
    --tw-prose-bold: theme('colors.gray.900');
    --tw-prose-counters: theme('colors.gray.500');
    --tw-prose-bullets: theme('colors.gray.400');
    --tw-prose-hr: theme('colors.gray.300');
    --tw-prose-quotes: theme('colors.gray.900');
    --tw-prose-quote-borders: theme('colors.gray.300');
    --tw-prose-captions: theme('colors.gray.700');
    --tw-prose-code: theme('colors.gray.900');
    --tw-prose-pre-code: theme('colors.gray.100');
    --tw-prose-pre-bg: theme('colors.gray.900');
    --tw-prose-th-borders: theme('colors.gray.300');
    --tw-prose-td-borders: theme('colors.gray.200');
  }

  /* Dark theme prose styles */
  .dark .prose {
    --tw-prose-body: theme('colors.gray.300');
    --tw-prose-headings: theme('colors.white');
    --tw-prose-lead: theme('colors.gray.400');
    --tw-prose-links: theme('colors.blue.400');
    --tw-prose-bold: theme('colors.white');
    --tw-prose-counters: theme('colors.gray.400');
    --tw-prose-bullets: theme('colors.gray.500');
    --tw-prose-hr: theme('colors.gray.600');
    --tw-prose-quotes: theme('colors.gray.100');
    --tw-prose-quote-borders: theme('colors.gray.600');
    --tw-prose-captions: theme('colors.gray.400');
    --tw-prose-code: theme('colors.white');
    --tw-prose-pre-code: theme('colors.gray.200');
    --tw-prose-pre-bg: theme('colors.gray.800');
    --tw-prose-th-borders: theme('colors.gray.600');
    --tw-prose-td-borders: theme('colors.gray.700');
  }

  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    scroll-margin-top: 2rem;
  }

  /* Additional dark theme styles for better readability */
  .dark .prose blockquote {
    border-left-color: theme('colors.gray.600');
  }

  .dark .prose code {
    background-color: theme('colors.gray.700');
    color: theme('colors.gray.200');
  }

  .dark .prose pre {
    background-color: theme('colors.gray.800');
    border: 1px solid theme('colors.gray.700');
  }

  .dark .prose table {
    border-color: theme('colors.gray.700');
  }

  .dark .prose th,
  .dark .prose td {
    border-color: theme('colors.gray.700');
  }
</style>
