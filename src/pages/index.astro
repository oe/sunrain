---
import { getCollection } from 'astro:content';
import { getLocale } from 'astro-i18n-aut';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { type Language } from '@/i18n/config';
import { useTranslations, getRelativeLocaleUrl } from '@/i18n/utils';

const lang = getLocale(Astro.url) as Language;

const t = useTranslations(lang);

// Get featured guide content
const allGuides = await getCollection('guide', ({ id }) =>
  id.startsWith('en/')
);
const featuredGuides = allGuides
  .filter((guide) => guide.data.featured)
  .slice(0, 3);

// Load resources data
const musicData = await import('@/content/resources/music.json');
const moviesData = await import('@/content/resources/movies.json');
const booksData = await import('@/content/resources/books.json');

const musicItems = musicData.default.en.items.slice(0, 3);
const movieItems = moviesData.default.en.items.slice(0, 3);
const bookItems = booksData.default.en.items.slice(0, 3);
---

<BaseLayout
  title={t('hero.title')}
  description={t('meta.description')}
  lang={lang}
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-blue-50 to-indigo-100 py-20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
        {t('hero.title')}
      </h1>
      <p class="text-xl md:text-2xl text-gray-600 mb-8 max-w-3xl mx-auto">
        {t('hero.subtitle')}
      </p>
      <a
        href={getRelativeLocaleUrl(lang, '/guide/')}
        class="inline-flex items-center px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition-colors shadow-lg"
      >
        {t('hero.cta')}
        <svg
          class="ml-2 w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 7l5 5-5 5M6 12h12"></path>
        </svg>
      </a>
    </div>
  </section>

  <!-- Featured Guides Section -->
  <section class="py-16 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          {t('guide.title')}
        </h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          {t('guide.subtitle')}
        </p>
      </div>

      <div class="grid md:grid-cols-3 gap-8">
        {
          featuredGuides.map((guide) => (
            <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow border border-gray-200">
              <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-3">
                  {guide.data.title}
                </h3>
                <p class="text-gray-600 mb-4">{guide.data.description}</p>
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-500">
                    {guide.data.publishDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </span>
                  <a
                    href={getRelativeLocaleUrl(lang, `/guide/${guide.slug.replace('en/', '')}`)}
                    class="text-blue-600 hover:text-blue-800 font-medium transition-colors"
                  >
                    {t('read.more')} →
                  </a>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      <div class="text-center mt-8">
        <a
          href={getRelativeLocaleUrl(lang, '/guide/')}
          class="inline-flex items-center px-6 py-3 border border-blue-600 text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition-colors"
        >
          View All Guides
          <svg
            class="ml-2 w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5-5 5M6 12h12"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Resources Preview Section -->
  <section class="py-16 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          {t('resources.title')}
        </h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          {t('resources.subtitle')}
        </p>
      </div>

      <!-- Resources Tabs -->
      <div class="mb-8">
        <div class="border-b border-gray-200">
          <nav class="-mb-px flex justify-center space-x-8">
            <button
              class="resource-tab active py-2 px-1 border-b-2 border-blue-500 font-medium text-blue-600"
              data-tab="music"
            >
              {t('resources.music')}
            </button>
            <button
              class="resource-tab py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700"
              data-tab="movies"
            >
              {t('resources.movies')}
            </button>
            <button
              class="resource-tab py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700"
              data-tab="books"
            >
              {t('resources.books')}
            </button>
          </nav>
        </div>
      </div>

      <!-- Music Resources -->
      <div id="music-content" class="resource-content">
        <div class="grid md:grid-cols-3 gap-6">
          {
            musicItems.map((item) => (
              <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="font-semibold text-gray-900 mb-2">{item.title}</h3>
                <p class="text-sm text-gray-600 mb-3">{item.artist}</p>
                <p class="text-gray-600 mb-4 text-sm">{item.description}</p>
                <div class="flex flex-wrap gap-2 mb-4">
                  {item.benefits.slice(0, 2).map((benefit) => (
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                      {benefit}
                    </span>
                  ))}
                </div>
                <div class="flex space-x-2">
                  <a
                    href={item.spotifyUrl}
                    class="text-green-600 hover:text-green-800 text-sm"
                  >
                    Spotify
                  </a>
                  <a
                    href={item.youtubeUrl}
                    class="text-red-600 hover:text-red-800 text-sm"
                  >
                    YouTube
                  </a>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Movies Resources -->
      <div id="movies-content" class="resource-content hidden">
        <div class="grid md:grid-cols-3 gap-6">
          {
            movieItems.map((item) => (
              <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="font-semibold text-gray-900 mb-2">{item.title}</h3>
                <p class="text-sm text-gray-600 mb-3">
                  {item.director} • {item.year}
                </p>
                <p class="text-gray-600 mb-4 text-sm">{item.description}</p>
                <div class="flex flex-wrap gap-2 mb-4">
                  {item.benefits.slice(0, 2).map((benefit) => (
                    <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">
                      {benefit}
                    </span>
                  ))}
                </div>
                <div class="flex space-x-2">
                  <a
                    href={item.streamingUrl}
                    class="text-blue-600 hover:text-blue-800 text-sm"
                  >
                    Watch
                  </a>
                  <a
                    href={item.trailerUrl}
                    class="text-red-600 hover:text-red-800 text-sm"
                  >
                    Trailer
                  </a>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Books Resources -->
      <div id="books-content" class="resource-content hidden">
        <div class="grid md:grid-cols-3 gap-6">
          {
            bookItems.map((item) => (
              <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="font-semibold text-gray-900 mb-2">{item.title}</h3>
                <p class="text-sm text-gray-600 mb-3">
                  {item.author} • {item.year}
                </p>
                <p class="text-gray-600 mb-4 text-sm">{item.description}</p>
                <div class="flex flex-wrap gap-2 mb-4">
                  {item.benefits.slice(0, 2).map((benefit) => (
                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">
                      {benefit}
                    </span>
                  ))}
                </div>
                <div class="flex space-x-2">
                  <a
                    href={item.amazonUrl}
                    class="text-orange-600 hover:text-orange-800 text-sm"
                  >
                    Amazon
                  </a>
                  <a
                    href={item.goodreadsUrl}
                    class="text-yellow-600 hover:text-yellow-800 text-sm"
                  >
                    Goodreads
                  </a>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <div class="text-center mt-8">
        <a
          href={getRelativeLocaleUrl(lang, '/resources/')}
          class="inline-flex items-center px-6 py-3 border border-blue-600 text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition-colors"
        >
          View All Resources
          <svg
            class="ml-2 w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5-5 5M6 12h12"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Call to Action Section -->
  <section class="py-16 bg-blue-600">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
        Start Your Healing Journey Today
      </h2>
      <p class="text-xl text-blue-100 mb-8">
        Take the first step towards better mental health with our comprehensive
        resources and guides.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href={getRelativeLocaleUrl(lang, '/guide/')}
          class="inline-flex items-center justify-center px-8 py-4 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-50 transition-colors"
        >
          Start with Guides
        </a>
        <a
          href={getRelativeLocaleUrl(lang, '/resources/')}
          class="inline-flex items-center justify-center px-8 py-4 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-blue-600 transition-colors"
        >
          Explore Resources
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.resource-tab');
    const contents = document.querySelectorAll('.resource-content');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');

        // Remove active class from all tabs
        tabs.forEach((t) => {
          t.classList.remove('active', 'border-blue-500', 'text-blue-600');
          t.classList.add('border-transparent', 'text-gray-500');
        });

        // Add active class to clicked tab
        tab.classList.add('active', 'border-blue-500', 'text-blue-600');
        tab.classList.remove('border-transparent', 'text-gray-500');

        // Hide all content
        contents.forEach((content) => content.classList.add('hidden'));

        // Show target content
        const targetContent = document.getElementById(`${targetTab}-content`);
        if (targetContent) {
          targetContent.classList.remove('hidden');
        }
      });
    });
  });
</script>
