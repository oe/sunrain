# 翻译完整性修复实施计划

## 实施任务

- [ ] 1. 检测和修复SSG翻译缺失问题
  - 检查现有SSG翻译文件的完整性
  - 识别缺失的翻译键和未翻译的内容
  - 补全所有支持语言的缺失翻译
  - _需求: 1.1, 1.3, 2.1, 2.2_

- [x] 1.1 创建翻译完整性检测脚本
  - 实现 `packages/website/scripts/check-translations.js`
  - 扫描 `packages/website/src/locales` 目录下的所有翻译文件
  - 以英文翻译为基准，检测其他语言缺失的翻译键
  - 识别未翻译的内容（与默认语言相同的文本）
  - 生成详细的缺失翻译报告（JSON和可读格式）
  - 支持命令行参数指定检查的语言和模块
  - _需求: 1.1, 1.2, 2.1_

- [x] 1.2 补全缺失的SSG翻译
  - 基于检测报告，为所有支持的语言补全缺失的翻译键
  - 重点关注assessment、shared、home、guide、resources、about模块
  - 确保心理健康专业术语的准确性和一致性
  - 考虑文化差异和本地化需求
  - _需求: 1.1, 1.3, 2.1, 2.2, 2.3_

- [x] 1.3 验证SSG翻译质量
  - 对补全后的翻译进行质量检查
  - 确保专业术语在不同语言中的一致性
  - 测试不同语言环境下的用户体验
  - _需求: 2.1, 2.2_

- [x] 2. 创建CSR翻译系统
  - 为客户端组件创建独立的翻译系统
  - 从现有SSG翻译中提取客户端相关内容
  - 确保CSR翻译的完整性
  - _需求: 4.1, 4.2, 6.1, 6.2_

- [x] 2.1 创建CSR翻译类型定义
  - 在 `packages/website/src/client-locales/shared/types.ts` 中定义CSR翻译接口
  - 创建客户端特定的翻译结构（client、interactive、actions等）
  - 确保与现有SSG类型的兼容性
  - _需求: 4.1, 4.3_

- [x] 2.2 分析并创建assessment模块的CSR翻译
  - 检查assessment模块中的客户端组件翻译需求
  - 在 `packages/website/src/client-locales/assessment/` 创建目录结构
  - 从SSG翻译中提取客户端相关内容（client、errors、loading、actions等）
  - 为所有支持的语言创建对应的CSR翻译文件
  - _需求: 4.1, 4.2, 6.1_

- [x] 2.3 创建CSR翻译管理器
  - 创建 `packages/website/src/utils/csr-translation-manager.ts`
  - 实现客户端动态翻译加载（从client-locales目录）
  - 添加预加载和智能缓存机制
  - 实现语言切换和状态管理
  - _需求: 3.1, 5.1, 5.3_

- [x] 2.4 优化现有的useTranslations Hook
  - 修改 `packages/website/src/hooks/useTranslations.ts` 支持CSR翻译加载
  - 保持向后兼容性，不影响现有功能
  - 优化性能和内存使用
  - 添加更好的错误处理
  - _需求: 5.1, 5.4_

- [ ] 3. 创建基本翻译验证工具
  - 创建简单的翻译完整性检查脚本
  - 检测SSG翻译文件的缺失键值
  - 生成基本的缺失翻译报告
  - _需求: 3.2, 3.4_

- [x] 3.1 创建翻译验证脚本
  - 实现 `packages/website/scripts/validate-translations.ts`
  - 检查所有SSG翻译文件的完整性
  - 以英文翻译为基准，检测其他语言缺失的翻译键
  - 生成简单的缺失翻译报告
  - _需求: 3.2, 3.4_

- [-] 7. 修复现有翻译缺失问题
  - 补全所有语言的缺失翻译
  - 提升翻译质量和文化适应性
  - 确保专业术语的一致性
  - _需求: 1.1, 1.3, 2.1, 2.2, 2.3_

- [x] 7.1 修复CSR翻译系统的关键问题
  - 分析CSR页面(如/assessment/take/phq-9/)实际使用的翻译键，识别真正缺失的翻译
  - 移除CSR翻译文件中大量未使用的翻译内容，只保留实际需要的翻译
  - 修复CSR翻译键结构：去掉不必要的"client"前缀，因为CSR翻译系统与SSG分离
  - 补全CSR组件实际需要的翻译键(如assessment.title, progress.text, questionList.*, navigation.*, errors.boundary.*等)
  - 修复语言切换后CSR页面翻译仍为英语的问题，确保CSR翻译管理器正确响应语言变化
  - 更新所有语言的CSR翻译文件，确保结构一致且只包含实际使用的翻译
  - _需求: 1.1, 1.3, 5.4, 6.4_

- [x] 7.1.1 补充CSR翻译文件中缺失的内容
  - 检查SSG翻译文件中的客户端相关内容
  - 将缺失的list、results、history、continue、trends等部分添加到CSR翻译
  - 更新CSR翻译类型定义以包含新增内容
  - 确保所有语言的CSR翻译文件保持一致
  - _需求: 4.1, 4.2, 6.1_

- [ ] 7.2 优化心理健康专业术语翻译
  - 审查和改进心理健康相关术语的翻译
  - 确保不同语言中专业术语的一致性
  - 考虑文化差异和本地化需求
  - _需求: 2.1, 2.2, 2.3_

- [ ] 7.3 验证和测试翻译质量
  - 对所有翻译进行质量检查
  - 测试不同语言环境下的用户体验
  - 修复发现的翻译问题
  - _需求: 2.1, 2.2_

- [ ] 7.4 紧急修复：分离SSG和CSR翻译系统
  - 立即修复客户端打印SSG翻译日志的问题
  - 修复访问英文页面时提示预加载中文的问题（如"Preloading assessment type: anxiety for language: zh"）
  - 将所有客户端组件配置为 `client:only`，确保完全在客户端渲染
  - 确保CSR和SSG翻译系统完全分离，各自使用独立的翻译函数
  - 移除SSG翻译中的hook依赖，直接在Astro组件中使用翻译函数
  - _需求: 5.1, 5.4, 6.4_

- [x] 8. 更新翻译加载机制
  - 修改现有的翻译加载逻辑以支持新的架构
  - 确保SSG和CSR翻译的正确加载
  - 优化性能和缓存策略
  - _需求: 5.1, 5.2, 5.3, 6.3, 6.4_

- [x] 8.1 彻底分离SSG和CSR翻译系统
  - 将所有客户端组件改为使用 `client:only` 指令，确保CSR内容只在客户端渲染
  - 创建独立的SSG翻译函数，不使用React hooks，直接在Astro组件中调用
  - 创建独立的CSR翻译hook，只在客户端组件中使用
  - 移除CSR和SSG翻译系统之间的任何共享代码和混用情况
  - 确保SSG翻译不会在客户端打印日志，CSR翻译不会在服务端执行
  - _需求: 5.1, 6.3, 6.4_

- [x] 8.2 修复语言预加载和日志问题
  - 修复访问英文页面时显示中文预加载信息的问题
  - 移除客户端渲染时打印的SSG翻译日志
  - 确保CSR翻译管理器只预加载当前页面语言的翻译
  - 添加语言检测逻辑，避免不必要的翻译预加载
  - 优化翻译加载的日志输出，区分开发和生产环境
  - _需求: 5.2, 5.3, 5.4_

- [x] 8.3 优化翻译加载性能和用户体验
  - 实现CSR翻译的智能预加载，只加载当前语言和用户可能切换的语言
  - 优化SSG翻译的服务端加载，确保构建时正确处理所有语言
  - 添加翻译加载失败的优雅降级机制
  - 实现语言切换时的平滑过渡，避免闪烁和延迟
  - _需求: 5.2, 5.3, 5.4, 6.4_

- [ ] 9. 添加错误处理和监控
  - 实现全面的翻译错误处理机制
  - 添加翻译加载失败的监控和报告
  - 提供友好的用户错误提示
  - _需求: 5.2, 5.3_

- [ ] 9.1 创建翻译错误处理器
  - 实现 `packages/website/src/utils/translation-error-handler.ts`
  - 添加不同类型错误的处理逻辑
  - 实现错误报告和监控功能
  - _需求: 5.2_

- [ ] 9.2 添加翻译加载状态管理
  - 在翻译管理器中添加加载状态跟踪
  - 实现加载失败的重试机制
  - 添加用户友好的错误提示
  - _需求: 5.2, 5.3_

- [ ] 9.3 实现翻译缺失的运行时检测
  - 在生产环境中检测和记录缺失的翻译
  - 实现本地存储的缺失翻译收集
  - 提供开发者工具用于调试翻译问题
  - _需求: 5.2_

- [ ] 10. 创建测试套件
  - 为翻译系统创建全面的测试覆盖
  - 确保翻译功能的稳定性和可靠性
  - 添加自动化测试到CI/CD流程
  - _需求: 1.4, 2.4, 3.4_

- [ ] 10.1 创建翻译管理器单元测试
  - 为SSG和CSR翻译管理器编写单元测试
  - 测试翻译加载、缓存和错误处理逻辑
  - 确保边界情况的正确处理
  - _需求: 1.4, 2.4_

- [ ] 10.2 创建翻译验证器测试
  - 为翻译验证器编写全面的测试用例
  - 测试各种翻译错误和警告的检测
  - 验证报告生成的准确性
  - _需求: 1.4, 2.4_

- [ ] 10.3 创建端到端翻译测试
  - 测试完整的翻译工作流程
  - 验证多语言用户界面的正确性
  - 测试语言切换和状态同步
  - _需求: 3.4_

- [ ] 11. 文档和维护指南
  - 创建翻译系统的使用文档
  - 编写维护和更新指南
  - 提供最佳实践和故障排除指南
  - _需求: 3.4_

- [ ] 11.1 编写翻译系统使用文档
  - 创建开发者使用指南
  - 文档化CLI工具的使用方法
  - 提供翻译文件结构和类型的说明
  - _需求: 3.4_

- [ ] 11.2 创建翻译维护指南
  - 编写翻译更新和同步的流程文档
  - 提供翻译质量检查的最佳实践
  - 创建故障排除和调试指南
  - _需求: 3.4_

- [ ] 11.3 建立翻译贡献流程
  - 创建社区翻译贡献的指南
  - 建立翻译审核和质量控制流程
  - 提供翻译工具和资源的使用说明
  - _需求: 3.4_
